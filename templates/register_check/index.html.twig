{% extends 'base.html.twig' %}

{% block title %}Hello RegisterCheckController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

<div class="example-wrapper">
    <input type="text" name="ajax" id="ajax"> <button id="request-btn">Envoyer</button>
<div>
<a id="lien" href="">Lien vers Register</a>
{% endblock %}


{% block script %}

<script>
let lien = document.querySelector('#lien')

async function ajax() {
    try{
        let request = await fetch("http://localhost:8000/ajax", { method: 'GET'},{'X-Requested-With': 'XMLHttpRequest'});
            if (!request.status == '200') {
                alert("Une erreur est survenue " + request.status);
            } else {
                let data = await request.json();
                console.log(data)
                let input = document.querySelector('#ajax')
                input.value ='{{ url('app_register') }}?token='+data
                lien.setAttribute('href',input.value)
            }
        }catch (error){
        console.log(error)
        }
}
    let requestBtn = document.querySelector('#request-btn')
    requestBtn.addEventListener('click',()=>{

    ajax()

    })

</script>

{% endblock  %}